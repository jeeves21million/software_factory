{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://software-factory-agents/contracts/agents/ui_design_agent.input.schema.json",
  "title": "ui_design_agent Input",
  "type": "object",
  "additionalProperties": false,
  "required": ["job", "payload"],
  "properties": {
    "job": { "$ref": "../common/job_envelope.schema.json" },
    "payload": {
      "type": "object",
      "additionalProperties": false,
      "required": ["design_brief", "inspirations", "required_screens", "output_spec", "quality_gate"],
      "properties": {
        "design_brief": {
          "type": "object",
          "additionalProperties": false,
          "required": ["overview", "design_direction", "required_screens"],
          "properties": {
            "overview": { "type": "string", "minLength": 1 },
            "design_direction": {
              "type": "array",
              "minItems": 3,
              "items": { "type": "string", "minLength": 1 }
            },
            "required_screens": {
              "type": "array",
              "minItems": 1,
              "uniqueItems": true,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["id", "name", "purpose", "priority"],
                "properties": {
                  "id": {
                    "type": "string",
                    "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
                  },
                  "name": { "type": "string", "minLength": 1 },
                  "purpose": { "type": "string", "minLength": 1 },
                  "priority": { "type": "string", "enum": ["critical", "high", "medium", "low"] }
                }
              }
            }
          }
        },
        "inspirations": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "comment"],
            "properties": {
              "type": { "type": "string", "enum": ["link", "image", "comment"] },
              "value": { "type": "string" },
              "comment": { "type": "string", "minLength": 1 }
            }
          }
        },
        "brand_pack": { "type": "object" },
        "brand_foundation": { "type": "object" },
        "required_screens": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
          }
        },
        "accessibility_target": { "type": "string" },
        "output_spec": {
          "type": "object",
          "additionalProperties": false,
          "required": ["format", "variants", "file_template", "manifest_file", "quality_report_file"],
          "properties": {
            "format": { "type": "string", "const": "html" },
            "variants": {
              "type": "array",
              "minItems": 2,
              "items": { "type": "string", "enum": ["desktop", "mobile"] },
              "allOf": [
                { "contains": { "const": "desktop" } },
                { "contains": { "const": "mobile" } }
              ]
            },
            "file_template": { "type": "string", "minLength": 1 },
            "manifest_file": { "type": "string", "minLength": 1 },
            "quality_report_file": { "type": "string", "minLength": 1 }
          }
        },
        "quality_gate": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "tier",
            "require_distinct_mobile_layouts",
            "forbid_placeholder_copy",
            "forbid_desktop_label_in_mobile",
            "require_interaction_states",
            "require_key_screen_options",
            "min_visual_options_per_key_screen",
            "require_differentiation_from_competitors",
            "forbid_fixed_viewport_width_meta",
            "forbid_external_cdn_assets",
            "require_state_variant_files",
            "state_variant_suffixes",
            "minimum_uniqueness_score"
          ],
          "properties": {
            "tier": { "type": "string", "enum": ["premium"] },
            "require_distinct_mobile_layouts": { "type": "boolean", "const": true },
            "forbid_placeholder_copy": { "type": "boolean", "const": true },
            "forbid_desktop_label_in_mobile": { "type": "boolean", "const": true },
            "require_interaction_states": {
              "type": "array",
              "items": { "type": "string", "enum": ["loading", "empty", "error", "success"] },
              "allOf": [
                { "contains": { "const": "loading" } },
                { "contains": { "const": "empty" } },
                { "contains": { "const": "error" } },
                { "contains": { "const": "success" } }
              ]
            },
            "require_key_screen_options": { "type": "boolean", "const": true },
            "min_visual_options_per_key_screen": { "type": "integer", "minimum": 3 },
            "require_differentiation_from_competitors": { "type": "boolean", "const": true },
            "forbid_fixed_viewport_width_meta": { "type": "boolean", "const": true },
            "forbid_external_cdn_assets": { "type": "boolean", "const": true },
            "require_state_variant_files": { "type": "boolean", "const": true },
            "state_variant_suffixes": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["--default", "--loading", "--empty", "--error", "--success"]
              },
              "allOf": [
                { "contains": { "const": "--default" } },
                { "contains": { "const": "--loading" } },
                { "contains": { "const": "--empty" } },
                { "contains": { "const": "--error" } },
                { "contains": { "const": "--success" } }
              ]
            },
            "minimum_uniqueness_score": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
          },
          "allOf": [
            {
              "properties": {
                "min_visual_options_per_key_screen": { "minimum": 3 }
              },
              "required": ["min_visual_options_per_key_screen"]
            },
            {
              "properties": {
                "minimum_uniqueness_score": { "minimum": 0.75 }
              },
              "required": ["minimum_uniqueness_score"]
            }
          ]
        }
      },
      "anyOf": [
        { "required": ["brand_pack"] },
        { "required": ["brand_foundation"] }
      ]
    }
  }
}
